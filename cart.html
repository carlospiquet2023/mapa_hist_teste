<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Carteirinha de Passeio</title>
<!--
  Notas de altera√ß√µes (19/09/2025): ajustes finos em tipografia, espa√ßamentos e responsividade para equilibrar
  frente e verso da carteirinha. Rever visualmente em `teste.html` se necess√°rio.
-->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #2d3748;
  }

  .container {
    max-width: 1400px;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
  }

  @media (max-width: 1024px) {
    .container {
      grid-template-columns: 1fr;
      gap: 30px;
    }
  }

  /* Formul√°rio */
  .form-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 24px;
    padding: 40px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .form-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 35px 70px rgba(0, 0, 0, 0.15);
  }

  h1 {
    color: #1a202c;
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  h1::before {
    content: "üé´";
    font-size: 36px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .subtitle {
    color: #718096;
    font-size: 16px;
    margin-bottom: 32px;
    font-weight: 500;
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    color: #4a5568;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  input[type="text"],
  input[type="date"],
  select {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #e2e8f0;
    border-radius: 14px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.3s ease;
    background: #f7fafc;
    outline: none;
  }

  input:focus,
  select:focus {
    border-color: #3182ce;
    background: white;
    box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.1);
    transform: scale(1.02);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  /* Upload de Foto */
  .photo-upload {
    position: relative;
    height: 140px;
    border: 2px dashed #cbd5e1;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    overflow: hidden;
  }

  .photo-upload:hover {
    border-color: #3182ce;
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    transform: scale(1.02);
  }

  .photo-upload input[type="file"] {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }

  .photo-upload-content {
    text-align: center;
    padding: 20px;
  }

  .photo-upload-icon {
    font-size: 40px;
    margin-bottom: 8px;
  }

  .photo-upload-text {
    color: #64748b;
    font-size: 14px;
    font-weight: 500;
  }

  .photo-preview {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
  }

  /* Condi√ß√µes m√©dicas */
  .conditions-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
  }

  .condition-chip {
    background: #fee2e2;
    color: #dc2626;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .condition-chip:hover {
    background: #dc2626;
    color: white;
  }

  .condition-chip input {
    display: none;
  }

  .condition-chip input:checked + span {
    background: #dc2626;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    display: inline-block;
  }

  /* Preview Section */
  .preview-section {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .cards-container {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 30px;
  }

  /* Carteirinha */
  .card {
    width: 400px;
    height: auto;
    min-height: 250px;
    background: white;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: visible;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: scale(1.02);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
  }

  /* Marca d'√°gua (fundo) aplicada √†s carteirinhas usando ::after para evitar conflito com ::before
     (h√° outra regra .card::before usada como barra decorativa). */
  .card::after,
  .card-back::after,
  .download-card::after,
  .download-card.card-back::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url('https://i.imgur.com/aAQt0f3.jpeg');
    background-repeat: no-repeat;
    background-position: center center;
    background-size: contain;
    opacity: 0.06; /* muito transparente */
    pointer-events: none;
    z-index: 0; /* atr√°s do conte√∫do */
    border-radius: inherit;
  }

  /* Garantir que o conte√∫do da carteirinha fique acima da marca d'√°gua */
  .card > *,
  .card-back > *,
  .download-card > * {
    position: relative;
    z-index: 1;
  }

  /* Moldura decorativa (opcional) aplicada √† carteirinha */
  .card.frame {
    padding: 12px; /* reduzir para acomodar a moldura interna */
    background: linear-gradient(180deg, #ffffff, #ffffff) padding-box;
    border-radius: 18px;
    box-shadow: 0 12px 30px rgba(2,6,23,0.14);
  }

  /* Borda interna decorativa usando pseudo-elemento */
  .card.frame::after {
    content: '';
    position: absolute;
    inset: 8px; /* cria um espa√ßamento para a borda */
    border-radius: 12px;
    pointer-events: none;
    background: linear-gradient(90deg, rgba(59,130,246,0.06), rgba(139,92,246,0.06));
    box-shadow: inset 0 0 0 2px rgba(59,130,246,0.12);
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px; /* sutil */
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
  }

  /* Header da carteirinha */
  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px; /* reduzido */
  }

  .logo-section {
    display: flex;
    align-items: center;
    gap: 8px; /* reduzido */
  }

  .logo-img {
    width: 36px; /* reduzido */
    height: 36px;
    object-fit: contain;
  }

  .logo-text {
    display: flex;
    flex-direction: column;
  }

  .org-name {
    font-size: 15px; /* leve redu√ß√£o */
    font-weight: 700;
    color: #0f172a;
    line-height: 1.1;
  }

  .card-type {
    font-size: 12px;
    color: #3b82f6;
    font-weight: 600;
  }

  /* Conte√∫do principal */
  .card-body {
    display: flex;
    gap: 12px; /* reduzido */
  }

  .student-photo {
    width: 88px; /* reduzido */
    height: 106px; /* reduzido */
    border-radius: 10px;
    background: #f1f5f9;
    overflow: hidden;
    flex-shrink: 0;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.06);
  }

  .student-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .student-info {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .student-name {
    font-size: 18px; /* reduzido */
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 6px;
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .student-details {
    font-size: 12px; /* reduzido */
    color: #64748b;
    margin-bottom: 8px;
  }

  .event-badge {
    background: #fef3c7;
    color: #92400e;
    padding: 6px 12px; /* reduzido */
    border-radius: 10px;
    font-size: 12px;
    font-weight: 700;
    display: inline-block;
    margin-bottom: 10px;
  }

  .medical-conditions {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    max-width: 100%;
    margin-top: 8px;
    margin-bottom: 6px; /* evita colar no rodap√© */
  }

  /* truncamento para localiza√ß√£o/badges quando necess√°rio */
  .event-badge span#locationInfo,
  .event-badge span#locationInfoDownload {
    display: inline-block;
    max-width: 220px; /* garante espa√ßo para badge + data */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }

  .condition-tag {
    padding: 4px 10px; /* ligeiro ajuste */
    border-radius: 14px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.4px;
  }

  /* For√ßar exibi√ß√£o em mai√∫sculas na carteirinha (preview e download) apenas nos campos de valor */
  .card .student-name,
  .download-card .student-name,
  .card .student-details strong,
  .download-card .student-details strong,
  .card #locationInfo,
  .download-card #locationInfoDownload,
  .card #dateInfo,
  .download-card #dateInfoDownload,
  .card .blood-type,
  .download-card .blood-type,
  .card .group-badge,
  .download-card .group-badge,
  .card .condition-tag,
  .download-card .condition-tag,
  .card #footerId,
  .download-card #footerIdDownload {
    text-transform: uppercase;
  }

  /* cores espec√≠ficas por posi√ß√£o */
  .condition-color-1 { background: #fee2e2; color: #9b1c1c; }
  .condition-color-2 { background: #dcfce7; color: #065f46; }
  .condition-color-3 { background: #dbeafe; color: #1e3a8a; }

  /* container que agrupa foto + condi√ß√µes abaixo */
  .photo-column {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
    flex-shrink: 0;
  }

  .extra-info {
    display: flex;
    gap: 24px;
    margin-top: 12px;
  }

  .info-block {
    text-align: left;
  }

  .info-label {
    font-size: 10px; /* reduzido */
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.4px;
    margin-bottom: 3px;
  }

  .blood-type {
    font-size: 20px; /* reduzido */
    font-weight: 800;
    color: #0f172a;
  }

  .group-badge {
    background: #dbeafe;
    color: #1e40af;
    padding: 5px 10px; /* reduzido */
    border-radius: 8px;
    font-size: 13px;
    font-weight: 700;
  }

  .card-footer {
    /* posicionamento est√°tico para que o footer seja empurrado para baixo quando o cart√£o cresce */
    position: static;
    margin-top: 12px;
    font-size: 10px; /* reduzido */
    color: #94a3b8;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .footer-logo {
    width: 24px;
    height: 24px;
    opacity: 0.7;
  }

  /* Verso da carteirinha */
  .card-back {
    /* For√ßar mesmas dimens√µes/estilos da frente */
    width: 400px !important;
    height: auto !important;
    min-height: 250px !important;
    background: white !important;
    border-radius: 20px !important;
    padding: 20px !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;
    position: relative !important;
    overflow: visible !important;
    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
  }



  /* Ajustes espec√≠ficos para equilibrar frente/verso: reduzir fontes e espa√ßamentos no verso */
  .card-back .rules-title {
    font-size: 20px; /* menor para equilibrar */
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 12px;
  }

  .card-back .rules-list li {
    font-size: 12px; /* reduzir ainda mais para compacta√ß√£o */
    margin-bottom: 4px;
    line-height: 1.0;
  }

  .card-back .rules-list li::before {
    font-size: 14px;
    left: 0;
    top: 2px;
  }

  .card-back .emergency-title {
    font-size: 14px; /* reduzir mais */
    font-weight: 700;
    margin-bottom: 8px;
    line-height: 1.0;
  }

  .card-back .emergency-row .label {
    font-size: 11px; /* reduzir */
    font-weight: 600;
    padding-right: 6px;
    line-height: 1.0;
  }

  /* Vers√£o de download (verso) - aplicar mesmas redu√ß√µes para garantir exporta√ß√£o consistente */
  .download-card.card-back .rules-title { font-size: 20px; }
  .download-card.card-back .rules-list li { font-size: 12px; margin-bottom: 4px; line-height: 1.15; }
  .download-card.card-back .rules-list li::before { font-size: 14px; }
  .download-card.card-back .emergency-title { font-size: 14px; }
  .download-card.card-back .emergency-row .label { font-size: 11px; }

  /* Duplicata removida: manter a defini√ß√£o original de .download-wrapper mais acima (padding 28px, width 440px)
     para preservar sombras e margens na exporta√ß√£o. */

  .card-back .emergency-row .line {
    border-bottom-width: 1px;
    height: 1px;
  }

  .rules-title {
    font-size: 36px; /* aumentado para destaque */
    font-weight: 800;
    color: #0f172a;
    margin-bottom: 20px;
  }

  .rules-list {
    list-style: none;
    margin-bottom: 20px;
    padding-left: 0;
  }

  .rules-list li {
    position: relative;
    padding-left: 28px; /* espa√ßo para o marcador */
    margin-bottom: 8px; /* reduzir espa√ßamento entre linhas */
    font-size: 18px; /* levemente menor para caber */
    color: #0f2e4a; /* cor mais escura similar √† refer√™ncia */
    line-height: 1.25; /* reduzir espa√ßamento */
  }

  /* vers√£o de download/impress√£o (compactar linhas para caber melhor) */
  .download-card .rules-list {
    margin-bottom: 12px;
  }

  .download-card .rules-list li {
    margin-bottom: 6px;
    font-size: 16px;
    line-height: 1.15;
  }

  .rules-list li::before {
    content: "‚Ä¢";
    position: absolute;
    left: 0;
    top: 0;
    color: #0f2e4a; /* marcador escuro */
    font-weight: 900;
    font-size: 22px;
  }

  .emergency-section {
    margin-top: 8px;
    /* espa√ßamento maior entre linhas dentro desta se√ß√£o */
    --emergency-row-gap: 12px; /* reduzido para aproximar as linhas */
    line-height: 1.5; /* ajuste tipogr√°fico solicitado */
  }

  /* Aplicar mesmo espa√ßamento na vers√£o de download/impress√£o (verso) */
  .download-card .emergency-section { --emergency-row-gap: 12px; line-height: 1.5; }

  .emergency-title {
    font-size: 22px; /* destacado */
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 12px;
  }

  .emergency-field {
    border-bottom: 1px solid #e2e8f0;
    padding: 8px 0;
    margin-bottom: 8px;
    color: #0f2e4a;
  }

  /* campos de contato: r√≥tulo curto e linha cont√≠nua para preenchimento */
  .emergency-row {
    display: flex;
    align-items: baseline;
    gap: 0; /* linha come√ßa imediatamente ap√≥s ':' */
    padding: 6px 0;
    margin-bottom: var(--emergency-row-gap, 20px);
  }

  .emergency-row .label {
    display: inline-block;
    margin-right: 0; /* sem espa√ßo: linha come√ßa imediatamente */
    color: #334155;
    font-weight: 600;
    font-size: 13px;
    flex: 0 0 auto;
    padding-right: 6px; /* pequeno respiro visual se necess√°rio */
  }

  .emergency-row .line {
    flex: 1;
    border-bottom: 1px solid #cbd5e1;
    height: 1px;
  }

  /* garantir estilos tamb√©m na vers√£o de download/impress√£o */
  .download-card .emergency-row {
    margin-bottom: var(--emergency-row-gap, 20px);
  }

  /* posicionar logo no canto inferior direito do verso */
  .card-back .footer-logo {
    position: absolute;
    right: 18px;
    bottom: 18px;
    width: 36px;
    height: 36px;
    opacity: 1;
  }

  /* Bot√µes */
  .buttons-container {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn {
    padding: 16px 32px;
    border: none;
    border-radius: 16px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .btn-primary {
    background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(49, 130, 206, 0.4);
  }

  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(49, 130, 206, 0.5);
  }

  .btn-secondary {
    background: white;
    color: #3182ce;
    border: 2px solid #3182ce;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .btn-secondary:hover {
    background: #3182ce;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
  }

  /* Download container (hidden) */
  .download-container {
    position: fixed;
    left: -9999px;
    top: -9999px;
  }

  .download-wrapper {
    background: white;
    padding: 28px; /* aumentar padding para evitar cortes nas sombras/bordas */
    width: 440px; /* aumentar largura para segurarmos o conte√∫do com padding */
  }

  .download-card {
    width: 400px;
    height: auto;
    min-height: 250px;
    background: white;
    border-radius: 20px;
    padding: 24px;
    position: relative;
    overflow: visible;
    margin-bottom: 20px;
  }

  /* aplicar moldura tamb√©m na vers√£o de download */
  .download-card.frame {
    padding: 18px;
  }

  .download-card.frame::after {
    content: '';
    position: absolute;
    inset: 10px;
    border-radius: 14px;
    pointer-events: none;
    box-shadow: inset 0 0 0 2px rgba(59,130,246,0.08);
  }

  .download-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
  }
</style>
</head>
<body>

<div class="container">
  <!-- Formul√°rio -->
  <div class="form-section">
    <h1>Gerador de Carteirinha</h1>
    <p class="subtitle">Preencha os dados para gerar a carteirinha de passeio</p>

    <form id="formCard">
      <div class="form-group">
        <label for="nome">Nome Completo do Aluno</label>
  <input type="text" id="nome" placeholder="Digite o nome completo" maxlength="20">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="turma">Turma</label>
          <input type="text" id="turma" placeholder="Ex: 5¬∫ Ano" maxlength="6">
        </div>
        <div class="form-group">
          <label for="matricula">Matr√≠cula</label>
          <input type="text" id="matricula" placeholder="Ex: 000123" maxlength="9">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="identidade">N√∫mero de Identidade</label>
          <input type="text" id="identidade" placeholder="Ex: RG123456" maxlength="12">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dataPasseio">Data do Passeio</label>
          <input type="date" id="dataPasseio">
        </div>
        <div class="form-group">
          <label for="local">Local do Passeio</label>
          <input type="text" id="local" placeholder="Ex: Museu Hist√≥rico" maxlength="15">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="sangue">Tipo Sangu√≠neo</label>
          <select id="sangue">
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
          </select>
        </div>
        <div class="form-group">
          <label for="grupo">Cor do Grupo</label>
          <select id="grupo">
            <option value="Azul">Azul</option>
            <option value="Vermelho">Vermelho</option>
            <option value="Amarelo">Amarelo</option>
            <option value="Verde">Verde</option>
            <option value="Preto">Preto</option>
            <option value="Branco">Branco</option>
            <option value="Cinza">Cinza</option>
            <option value="Rosa">Rosa</option>
            <option value="Laranja">Laranja</option>
            <option value="Roxo">Roxo</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="condicoes">Condi√ß√µes M√©dicas</label>
        <select id="condicoes">
          <option value="">Nenhuma</option>
          <option value="TDAH">TDAH</option>
          <option value="TEA">TEA</option>
          <option value="DEP">DEP</option>
          <option value="TAG">TAG</option>
          <option value="FM">FM</option>
          <option value="LES">LES</option>
          <option value="DC">DC</option>
          <option value="DM1">DM1</option>
          <option value="EPI">EPI</option>
          <option value="EC">EC</option>
          <option value="EM">EM</option>
          <option value="SII">SII</option>
          <option value="DCe">DCe</option>
          <option value="TB">TB</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="photoInput">Foto do Aluno</label>
        <label class="photo-upload" for="photoInput" aria-label="Enviar foto do aluno">
          <input type="file" id="photoInput" accept="image/*">
          <div class="photo-upload-content" id="photoUploadContent">
            <div class="photo-upload-icon">üì∑</div>
            <div class="photo-upload-text">Clique ou arraste para enviar a foto</div>
          </div>
          <img class="photo-preview" id="photoPreview" style="display: none;" alt="Pr√©-visualiza√ß√£o da foto do aluno">
        </label>
        <small id="photoHelp" style="display:block; margin-top:8px; color:#718096; font-size:12px;">JPG/PNG recomendado. A foto ser√° recortada para o quadro.</small>
      </div>
    </form>
  </div>

  <!-- Preview -->
  <div class="preview-section">
    <div class="cards-container">
      <!-- Frente da Carteirinha -->
  <div class="card frame" id="cardFront">
        <div class="card-header">
          <div class="logo-section">
            <img src="https://i.imgur.com/iOLe2dJ.jpeg" alt="Logo" class="logo-img" id="logoImg">
            <div class="logo-text">
              <div class="org-name">Organiza√ß√£o Educacional | RJ- FII</div>
              <div class="card-type">Carteirinha de Passeio Hist√≥rico</div>
            </div>
          </div>
        </div>
        
        <div class="card-body">
          <div class="photo-column">
            <div class="student-photo">
              <img id="studentPhoto" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120' fill='%23e2e8f0'%3E%3Crect width='100' height='120' fill='%23f1f5f9'/%3E%3Ccircle cx='50' cy='40' r='20' fill='%23cbd5e1'/%3E%3Cellipse cx='50' cy='90' rx='35' ry='30' fill='%23cbd5e1'/%3E%3C/svg%3E" alt="Foto">
            </div>
            <div class="medical-conditions conditions-info"></div>
          </div>
          
          <div class="student-info">
            <div class="student-name" id="studentName">Nome do Aluno</div>
            <div class="student-details" id="detailsInfo">Turma: <strong>5¬∫ Ano</strong> ‚Ä¢ Matr√≠cula: <strong>000123</strong></div>
            <div class="event-badge">
              <span id="locationInfo">Museu Hist√≥rico</span> ‚Äî <span id="dateInfo">10/10/2025</span>
            </div>
            <div style="margin-top: auto;">
              <div class="extra-info">
                <div class="info-block">
                  <div class="info-label">Tipo Sangu√≠neo</div>
                  <div class="blood-type" id="bloodInfo">O+</div>
                </div>
                <div class="info-block">
                  <div class="info-label">Cor do grupo</div>
                  <div class="group-badge" id="groupInfo">Azul</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-footer">
          <span>Id: <span id="footerId">12345</span></span>
          <span>Cada passo √© uma descoberta.</span>
  <img src="https://i.imgur.com/iOLe2dJ.jpeg" alt="Logo" class="footer-logo">
        </div>
      </div>

      <!-- Verso da Carteirinha -->
      <div class="card card-back frame" id="cardBack">
        <div class="rules-title">Regras do Passeio</div>
        <ul class="rules-list">
          <li>Trazer bon√© ou chap√©u</li>
          <li>Usar roupa confort√°vel</li>
          <li>Levar √°gua</li>
          <li>Ficar junto ao grupo</li>
        </ul>
        
        <div class="emergency-section">
          <div class="emergency-title">Contato em caso de emerg√™ncia</div>
          <div class="emergency-row"><div class="label">Nome:</div><div class="line"></div></div>
          <div class="emergency-row"><div class="label">Telefone:</div><div class="line"></div></div>
          <div class="emergency-row"><div class="label">Observa√ß√µes:</div><div class="line"></div></div>
        </div>
        
        
    </div>

    <div class="buttons-container">
      <button class="btn btn-primary" onclick="downloadPNG()">
        <span>üíæ</span> Baixar PNG
      </button>
    </div>
  </div>
</div>

<!-- Container oculto para download -->
<div class="download-container" id="downloadContainer">
  <div class="download-wrapper">
    <!-- Frente -->
  <div class="download-card frame">
      <div class="card-header">
        <div class="logo-section">
          <img src="https://i.imgur.com/iOLe2dJ.jpeg" alt="Logo" class="logo-img" id="logoImgDownload">
          <div class="logo-text">
            <div class="org-name">Organiza√ß√£o Educacional | RJ - FII</div>
            <div class="card-type">Carteirinha de Passeio Hist√≥rico</div>
          </div>
        </div>
      </div>
      
      <div class="card-body">
        <div class="photo-column">
          <div class="student-photo">
            <img id="studentPhotoDownload" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120' fill='%23e2e8f0'%3E%3Crect width='100' height='120' fill='%23f1f5f9'/%3E%3Ccircle cx='50' cy='40' r='20' fill='%23cbd5e1'/%3E%3Cellipse cx='50' cy='90' rx='35' ry='30' fill='%23cbd5e1'/%3E%3C/svg%3E" alt="Foto">
          </div>
          <div class="medical-conditions conditions-info-download"></div>
        </div>
        
        <div class="student-info">
          <div class="student-name" id="studentNameDownload">Nome do Aluno</div>
          <div class="student-details" id="detailsInfoDownload">Turma: <strong>5¬∫ Ano</strong> ‚Ä¢ Matr√≠cula: <strong>000123</strong></div>
          <div class="event-badge">
            <span id="locationInfoDownload">Museu Hist√≥rico</span> ‚Äî <span id="dateInfoDownload">10/10/2025</span>
          </div>
          <div style="margin-top: auto;">
            <div class="extra-info">
              <div class="info-block">
                <div class="info-label">Tipo Sangu√≠neo</div>
                <div class="blood-type" id="bloodInfoDownload">O+</div>
              </div>
              <div class="info-block">
                <div class="info-label">Cor do grupo</div>
                <div class="group-badge" id="groupInfoDownload">Azul</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card-footer">
        <span>Id: <span id="footerIdDownload">12345</span></span>
        <span>Cada passo √© uma descoberta.</span>
  <img src="https://i.imgur.com/iOLe2dJ.jpeg" alt="Logo" class="footer-logo">
      </div>
    </div>
    
    <!-- Verso -->
    <div class="download-card card-back">
      <div class="rules-title">Regras do Passeio</div>
      <ul class="rules-list">
        <li>Trazer bon√© ou chap√©u</li>
        <li>Usar roupa confort√°vel</li>
        <li>Levar √°gua</li>
        <li>Ficar junto ao grupo</li>
      </ul>
      
      <div class="emergency-section">
        <div class="emergency-title">Contato em caso de emerg√™ncia</div>
        <div class="emergency-row"><div class="label">Nome:</div><div class="line"></div></div>
        <div class="emergency-row"><div class="label">Telefone:</div><div class="line"></div></div>
        <div class="emergency-row"><div class="label">Observa√ß√µes:</div><div class="line"></div></div>
      </div>
      
      <div class="card-footer">
        <span></span>
  <img src="https://i.imgur.com/iOLe2dJ.jpeg" alt="Logo" class="footer-logo">
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
<script>
  // Atualiza√ß√£o em tempo real
  const form = document.getElementById("formCard");
  
  // Fun√ß√£o para formatar data
  function formatDate(dateString) {
    if (!dateString) return "10/10/2025";
    const date = new Date(dateString);
    const userTimezoneOffset = date.getTimezoneOffset() * 60000;
    return new Date(date.getTime() + userTimezoneOffset).toLocaleDateString('pt-BR');
  }
  
  // Fun√ß√£o para atualizar condi√ß√µes (preenche todos os containers: preview e download)
  function updateConditions(value) {
  // Selecionar apenas os containers que ficam abaixo da foto (evita duplica√ß√£o em outras √°reas)
  const previewContainers = Array.from(document.querySelectorAll('.card .photo-column .conditions-info'));
  const downloadContainers = Array.from(document.querySelectorAll('.download-card .photo-column .conditions-info-download'));
  const allContainers = previewContainers.concat(downloadContainers);

    allContainers.forEach(container => {
      container.innerHTML = "";
      if (value) {
        const cond = value.trim();
        if (cond) {
          const tag = document.createElement("div");
          tag.className = "condition-tag condition-color-1"; // escolha √∫nica: cor 1 (vermelha)
          // garantir mai√∫sculas na exibi√ß√£o
          tag.textContent = cond.toUpperCase();
          container.appendChild(tag);
        }
      }
    });
  }
  
  // Fun√ß√£o para atualizar todos os campos
  function updateCard() {
    // Nome
    const name = form.nome.value || "Nome do Aluno";
    // exibir em mai√∫sculas na carteirinha
    const displayName = truncateText(name.toUpperCase(), 20);
    const studentNameEl = document.getElementById("studentName");
    const studentNameDlEl = document.getElementById("studentNameDownload");
    studentNameEl.textContent = displayName;
    studentNameEl.title = name.toUpperCase();
    studentNameDlEl.textContent = displayName;
    studentNameDlEl.title = name.toUpperCase();
    
    // Turma & Matr√≠cula
  const classText = form.turma.value || "5¬∫ Ano";
  const regText = form.matricula.value || ""; // manter valor original no input
  // exibir em mai√∫sculas
  const displayClass = truncateText(classText.toUpperCase(), 9);
  // remover zeros √† esquerda apenas para exibi√ß√£o
  const nakedReg = regText.replace(/^0+/, '');
  const displayReg = truncateText((nakedReg || regText) .toUpperCase(), 9) || '‚Äî';
  const detailsHtml = `Turma: <strong title="${escapeHtml(classText)}">${escapeHtml(displayClass)}</strong> ‚Ä¢ Matr√≠cula: <strong title="${escapeHtml(regText)}">${escapeHtml(displayReg)}</strong>`;
    document.getElementById("detailsInfo").innerHTML = detailsHtml;
    document.getElementById("detailsInfoDownload").innerHTML = detailsHtml;
    
    // Usar o novo campo 'identidade' para o footer (mantendo matr√≠cula nas informa√ß√µes)
  const idText = form.identidade ? (form.identidade.value || "") : "";
  const nakedId = idText.replace(/^0+/, '');
  const footerDisplay = (nakedId || idText) ? ((nakedId || idText).toUpperCase()) : '‚Äî';
  document.getElementById("footerId").textContent = footerDisplay;
  document.getElementById("footerIdDownload").textContent = footerDisplay;
    
    // Data
  const date = formatDate(form.dataPasseio.value);
    document.getElementById("dateInfo").textContent = date;
    document.getElementById("dateInfoDownload").textContent = date;
    
    // Local
  const location = form.local.value || "Museu Hist√≥rico";
  // exibir em mai√∫sculas
  const displayLocation = truncateText(location.toUpperCase(), 15);
  const locEl = document.getElementById("locationInfo");
  const locDlEl = document.getElementById("locationInfoDownload");
  locEl.textContent = displayLocation;
  locEl.title = location.toUpperCase();
  locDlEl.textContent = displayLocation;
  locDlEl.title = location.toUpperCase();
    
    // Tipo Sangu√≠neo
  // Tipo sangu√≠neo j√° em um formato curto; garantir mai√∫sculas
  const blood = (form.sangue.value || "O+").toUpperCase();
  document.getElementById("bloodInfo").textContent = blood;
  document.getElementById("bloodInfoDownload").textContent = blood;
    
    // Grupo
  const group = (form.grupo.value || "Azul").toUpperCase();
    const groupInfoEl = document.getElementById("groupInfo");
    const groupInfoDlEl = document.getElementById("groupInfoDownload");
    groupInfoEl.textContent = group;
    groupInfoDlEl.textContent = group;

    // Mapear nomes de cores para valores hex
    const colorMap = {
      'Vermelho': '#ef4444',
      'Azul': '#2563eb',
      'Amarelo': '#f59e0b',
      'Verde': '#16a34a',
      'Preto': '#000000',
      'Branco': '#ffffff',
      'Cinza': '#6b7280',
      'Rosa': '#ec4899',
      'Laranja': '#f97316',
      'Roxo': '#7c3aed'
    };

  // mapear o nome original (capitalizado) para cor: buscar chave independentemente de case
  const normalizedGroup = Object.keys(colorMap).find(k => k.toUpperCase() === group) || 'Azul';
  const selectedColor = colorMap[normalizedGroup] || '#2563eb';

    // aplicar cor ao texto do badge (preview e download)
    applyGroupColor(groupInfoEl, selectedColor);
    applyGroupColor(groupInfoDlEl, selectedColor);
    
    // Condi√ß√µes
    updateConditions(form.condicoes.value);
  }
  form.addEventListener("input", updateCard);
  
  // Upload de foto
  const photoInput = document.getElementById("photoInput");
  const photoPreview = document.getElementById("photoPreview");
  const photoUploadContent = document.getElementById("photoUploadContent");
  
  photoInput.addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (file && file.type.startsWith("image/")) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const imageUrl = e.target.result;
        
        // Atualizar preview no upload
        photoPreview.src = imageUrl;
        photoPreview.style.display = "block";
        photoUploadContent.style.display = "none";
        
        // Atualizar fotos nas carteirinhas
        document.getElementById("studentPhoto").src = imageUrl;
        document.getElementById("studentPhotoDownload").src = imageUrl;
      };
      reader.readAsDataURL(file);
    }
  });
  
  // Fun√ß√£o para carregar logo da pasta
  function loadLogo() {
    // URL padr√£o (imagem enviada pelo usu√°rio)
  const defaultLogo = "https://i.imgur.com/iOLe2dJ.jpeg";
    // definir imediatamente a logo padr√£o
    const logoEl = document.getElementById("logoImg");
    const logoDlEl = document.getElementById("logoImgDownload");
    if (logoEl) logoEl.src = defaultLogo;
    if (logoDlEl) logoDlEl.src = defaultLogo;
    const backLogo = document.querySelector(".download-card.card-back .footer-logo");
    if (backLogo) backLogo.src = defaultLogo;

    // tentar carregar override local em ./logo/logo.png sem substituir se falhar
    const localPath = "./logo/logo.png";
    const img = new Image();
    img.onload = function() {
      // s√≥ substituir se o arquivo local existir e carregar corretamente
      if (logoEl) logoEl.src = localPath;
      if (logoDlEl) logoDlEl.src = localPath;
      if (backLogo) backLogo.src = localPath;
    };
    img.onerror = function() {
      // manter o default (Imgur)
      console.log("Logo personalizado (logo.png) n√£o encontrado na pasta /logo/. Mantendo logo padr√£o.");
    };
    img.src = localPath;
  }
  
  // Carregar logo ao iniciar
  loadLogo();
  
  // Fun√ß√£o para baixar PNG
  async function downloadPNG() {
    const downloadContainer = document.getElementById("downloadContainer");
    const wrapper = downloadContainer.querySelector(".download-wrapper");
    
    updateCard();
    
    const originalDisplayStyle = downloadContainer.style.display;
    const originalLeft = downloadContainer.style.left;
    const originalTop = downloadContainer.style.top;
    const originalOpacity = downloadContainer.style.opacity;

    // tornar vis√≠vel e posicionar dentro da viewport para captura correta
    // usamos opacity:0 (em vez de visibility:hidden) porque html2canvas ignora elementos com visibility:hidden
    downloadContainer.style.display = 'block';
    downloadContainer.style.left = '0';
    downloadContainer.style.top = '0';
    downloadContainer.style.opacity = '0'; // invis√≠vel ao usu√°rio, mas renderiz√°vel

    // garantir que todas as imagens internas foram carregadas/decodificadas
    await Promise.all(Array.from(downloadContainer.querySelectorAll('img')).map(img => {
      if (img.complete) return Promise.resolve();
      return new Promise(res => { img.onload = img.onerror = res; });
    }));
    
    try {
      const canvas = await html2canvas(wrapper, {
        scale: 3,
        backgroundColor: null,
        useCORS: true
      });
      
      const link = document.createElement("a");
      link.download = `carteirinha_${form.nome.value || "aluno"}.png`;
      link.href = canvas.toDataURL("image/png");
      link.click();
    } finally {
      // restaurar valores originais
      downloadContainer.style.display = originalDisplayStyle;
      downloadContainer.style.left = originalLeft;
      downloadContainer.style.top = originalTop;
      downloadContainer.style.opacity = originalOpacity;
    }
  }
  
  // Valida√ß√£o do formul√°rio
  function validateForm() {
    const requiredFields = ['nome', 'turma', 'matricula', 'dataPasseio', 'local'];
    let isValid = true;
    
    requiredFields.forEach(field => {
      const element = document.getElementById(field);
      if (!element.value.trim()) {
        element.style.borderColor = '#e53e3e';
        isValid = false;
      } else {
        element.style.borderColor = '#e2e8f0';
      }
    });
    
    if (!isValid) {
      alert('Por favor, preencha todos os campos obrigat√≥rios.');
    }
    
    return isValid;
  }
  
  // Modificar bot√µes para validar antes de baixar
  document.querySelector('.btn-primary').addEventListener('click', function(e) {
    if (validateForm()) {
      downloadPNG();
    }
  });
  
  // Aplica cor ao elemento do badge, com tratamento para texto branco
  function applyGroupColor(el, color) {
    if (!el) return;
    el.style.color = color;
    // Se a cor for branca, adicionar borda escura leve para visibilidade
    if (color.toLowerCase() === '#ffffff' || color.toLowerCase() === 'white') {
      el.style.background = 'rgba(0,0,0,0.06)';
      el.style.border = '1px solid rgba(0,0,0,0.12)';
      el.style.padding = el.style.padding || '5px 10px';
      el.style.borderRadius = el.style.borderRadius || '8px';
    } else {
      // remover estilo extra caso n√£o seja branco
      el.style.background = '';
      el.style.border = '';
      // garantir padding/radius conforme .group-badge
      el.style.padding = '';
      el.style.borderRadius = '';
    }
  }

  // Helpers
  function truncateText(str, max) {
    if (!str) return "";
    return str.length > max ? str.slice(0, max - 1) + "‚Ä¶" : str;
  }

  function escapeHtml(text) {
    return String(text).replace(/[&<>"']/g, function(m) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
    });
  }
</script>

</body>
</html>
